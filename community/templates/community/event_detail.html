{% extends "base.html" %}
{% block content %}
  <h1>{{ event.title }}</h1>

  <div class="card">
    <table>
      <tr><th>Gunung/Lokasi</th><td>{{ event.mountain_name }}</td></tr>
      <tr><th>Waktu</th><td>{{ event.date_range_display }}</td></tr>
      <tr><th>Kapasitas</th><td>{{ event.capacity }} (Confirmed: {{ confirmed_count }})</td></tr>
      <tr><th>Status</th><td>{{ event.get_status_display }}</td></tr>
      <tr><th>Kesulitan</th><td>{{ event.get_difficulty_display }}</td></tr>
      <tr><th>Biaya</th><td>{% if event.price %}Rp {{ event.price|floatformat:0 }}{% else %}-{% endif %}</td></tr>
      <tr><th>Titik Kumpul</th><td>{{ event.meeting_point|default:"-" }}</td></tr>
      <tr><th>Kontak</th><td>{{ event.contact_person }}</td></tr>
      <tr><th>Organizer</th><td>{{ event.organizer }}</td></tr>
    </table>

    {% if event.description %}
      <div style="margin-top:12px">
        <strong>Deskripsi/Itinerary</strong>
        <p style="white-space:pre-wrap">{{ event.description }}</p>
      </div>
    {% endif %}
  </div>

  <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px">
    <a class="btn" href="{% url 'community:event_list' %}">‚Üê Kembali</a>

    {% if user.is_authenticated %}
      {% if user == event.organizer %}
        <a class="btn" href="{% url 'community:event_edit' event.pk %}">Edit</a>
        {% if event.status != "CANCELLED" %}
          <a class="btn" href="{% url 'community:event_cancel' event.pk %}">Batalkan</a>
        {% endif %}
      {% else %}
        {% if user_join and user_join.status == "CONFIRMED" %}
          <a class="btn" href="{% url 'community:event_leave' event.pk %}">Keluar dari Event</a>
        {% elif user_join and user_join.status == "WAITLIST" %}
          <span class="btn">Kamu di Waitlist</span>
          <a class="btn" href="{% url 'community:event_leave' event.pk %}">Batalkan Pendaftaran</a>
        {% else %}
          {% if event.status == "OPEN" %}
            <a class="btn btn-primary" href="{% url 'community:event_join' event.pk %}">Gabung Event</a>
          {% else %}
            <span class="btn">Pendaftaran tidak tersedia</span>
          {% endif %}
        {% endif %}
      {% endif %}
    {% else %}
      <a class="btn btn-primary" href="/accounts/login/?next={{ request.path }}">Login untuk bergabung</a>
    {% endif %}
  </div>

  <div class="card">
    <h3>Komentar</h3>
    {% for c in comments %}
      <div style="border-bottom:1px solid #eee;padding:8px 0">
        <div style="font-weight:600">{{ c.user }}</div>
        <div class="muted">{{ c.created_at|date:"d M Y H:i" }}</div>
        <p style="white-space:pre-wrap">{{ c.body }}</p>
      </div>
    {% empty %}
      <div class="muted">Belum ada komentar.</div>
    {% endfor %}

    {% if user.is_authenticated %}
      <form method="post" style="margin-top:12px">
        {% csrf_token %}
        {{ comment_form.body }}
        <div style="margin-top:8px">
          <button class="btn btn-primary" type="submit">Kirim</button>
        </div>
      </form>
    {% else %}
      <a class="btn" href="/accounts/login/?next={{ request.path }}">Login untuk berkomentar</a>
    {% endif %}
  </div>
{% endblock %}
