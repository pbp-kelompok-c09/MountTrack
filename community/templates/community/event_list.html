{% extends "base.html" %}
{% block content %}
  <h1>Community Events</h1>

  <form method="get" class="card">
    <div class="row">
      <div>
        <label>Gunung/Lokasi</label>
        <input type="text" name="mountain" value="{{ mountain }}">
      </div>
      <div>
        <label>Status</label>
        <select name="status">
          <option value="">Semua</option>
          <option value="OPEN" {% if status_q == "OPEN" %}selected{% endif %}>Open</option>
          <option value="FULL" {% if status_q == "FULL" %}selected{% endif %}>Full</option>
          <option value="DRAFT" {% if status_q == "DRAFT" %}selected{% endif %}>Draft</option>
        </select>
      </div>
    </div>
    <div style="margin-top:12px">
      <button class="btn btn-primary" type="submit">Filter</button>
      <a class="btn" href="{% url 'community:event_list' %}">Reset</a>
      {% if user.is_authenticated %}
        <a class="btn" href="{% url 'community:event_create' %}" style="float:right">+ Buat Event</a>
      {% endif %}
    </div>
  </form>

  {% for e in events %}
    <div class="card">
      <div style="display:flex;justify-content:space-between;gap:12px;align-items:baseline">
        <div>
          <a href="{% url 'community:event_detail' e.pk %}" style="font-weight:700;text-decoration:none">{{ e.title }}</a>
          <div class="muted">
            {{ e.mountain_name }} • {{ e.date_range_display }} • Kapasitas {{ e.capacity }}
            • Status: {{ e.get_status_display }}
            {% if e.price %} • Biaya: Rp {{ e.price|floatformat:0 }}{% endif %}
          </div>
        </div>
        <div class="muted">Organizer: {{ e.organizer }}</div>
      </div>
    </div>
  {% empty %}
    <div class="muted">Belum ada event.</div>
  {% endfor %}

  {% if events.paginator.num_pages > 1 %}
    <div class="pagination">
      {% if events.has_previous %}
        <a class="btn" href="?page={{ events.previous_page_number }}{% if mountain %}&mountain={{ mountain }}{% endif %}{% if status_q %}&status={{ status_q }}{% endif %}">← Prev</a>
      {% endif %}
      <span>Halaman {{ events.number }} dari {{ events.paginator.num_pages }}</span>
      {% if events.has_next %}
        <a class="btn" href="?page={{ events.next_page_number }}{% if mountain %}&mountain={{ mountain }}{% endif %}{% if status_q %}&status={{ status_q }}{% endif %}">Next →</a>
      {% endif %}
    </div>
  {% endif %}
{% endblock %}
