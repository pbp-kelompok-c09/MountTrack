{% extends 'base.html' %}

{% block meta %}
<title>MountTrack Admin</title>
{% endblock meta %}

{% block content %}
<h1>MountTrack Admin Management</h1>

<p>Login sebagai: <b>{{ request.user.username }}</b></p>
<p><a href="{% url 'userprofile:logout' %}">Logout</a></p>
<hr>

<table border="1" cellpadding="8">
  <tr>
    <th>Username</th>
    <th>Email</th>
    <th>Role</th>
    <th>Action</th>
  </tr>

  {% for user in users %}
  <tr>
    <td>{{ user.username }}</td>
    <td>{{ user.email }}</td>
    <td>
      {% if user.is_staff %}
        <b style="color:green;">Admin</b>
      {% else %}
        User
      {% endif %}
    </td>
    <td>
      {% if request.user != user %}
      <form method="post" style="display:inline;">
        {% csrf_token %}
        <input type="hidden" name="user_id" value="{{ user.id }}">
        <input type="hidden" name="action" value="toggle">
        <button type="submit">
          {% if user.is_staff %} Hapus Admin {% else %} Jadikan Admin {% endif %}
        </button>
      </form>

      <!-- tombol hapus -->
      <form method="post" style="display:inline;">
        {% csrf_token %}
        <input type="hidden" name="user_id" value="{{ user.id }}">
        <input type="hidden" name="action" value="delete">
        <button type="submit" onclick="return confirm('Yakin ingin menghapus user ini?');">
          Hapus User
        </button>
      </form>

      {% else %}
        <i>(Tidak bisa ubah atau hapus diri sendiri!)</i>
      {% endif %}
    </td>
  </tr>
  {% endfor %}
</table>

<hr>
<h3>Tambah User Baru</h3>
<form method="post" style="margin-bottom: 20px;">
  {% csrf_token %}
  <input type="hidden" name="action" value="add">
  <table>
    <tr>
      <td>Username:</td>
      <td><input type="text" name="username" required></td>
    </tr>
    <tr>
      <td>Email:</td>
      <td><input type="email" name="email"></td>
    </tr>
    <tr>
      <td>Password:</td>
      <td><input type="password" name="password" required></td>
    </tr>
    <tr>
      <td></td>
      <td><button type="submit">Tambah User</button></td>
    </tr>
  </table>
</form>


{% endblock content %}
