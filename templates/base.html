<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}MountTrack{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.10.1/dist/full.min.css" rel="stylesheet" type="text/css" />
    {% block meta %} {% endblock meta %}

    <!-- Memindahkan style block ke dalam head -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@800&display=swap');
        
        .font-sfPro {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        .shadow-input {
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>

<!-- Menggabungkan class dari kedua body tag -->
<body class="bg-gray-50 min-h-screen">
    {% if messages %} <!--Notifikasi Toast-->
    <div id="toast-container" class="fixed top-5 right-5 z-50 space-y-3">
        {% for message in messages %}
            <!-- MEMPERBAIKI KESALAHAN: Menghapus tanda kutip (") yang salah di akhir class -->
            <div class="toast-element p-4 rounded-lg shadow-lg text-white 
                        max-w-xs w-full 
                        transition-all duration-500 ease-out 
                        transform opacity-0 -translate-y-5
                        {% if message.tags == 'success' %}
                            bg-green-500
                        {% elif message.tags == 'error' %}
                            bg-red-600
                        {% elif message.tags == 'warning' %}
                            bg-yellow-500
                        {% elif message.tags == 'info' %}
                            bg-blue-500
                        {% else %}
                            bg-gray-700
                        {% endif %}
                        " 
                 role="alert">
                {{ message }}
            </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- MENGHAPUS NAVBAR DUPLIKAT PERTAMA -->
    
    <!-- Mempertahankan Navbar kedua (include) karena ada JS yang menyertainya -->
    {% include 'components/navbar.html' %}

    <!-- Page content -->
    <main class="pt-32 px-6">
        <!-- Mempertahankan hanya satu block content -->
        {% block content %}
        {% endblock %}
    </main>

    {% block scripts %}{% endblock %}

    <!-- Script untuk Navbar (dari file asli bagian kedua) -->
    <script>
        // Menu configuration - Update these paths to match your Django URLs
        const menuItems = [
          { 
              name: "Home", 
              path: "/", 
              icon: '<svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>' 
          },
          { 
              name: "Mountains", 
              path: "/fams/", 
              icon: '<svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 20h18L13 4 3 20z"></path><path d="M6.5 20l7-12 7 12"></path></svg>' 
          },
          { 
              name: "News", 
              path: "/news/", 
              icon: '<svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2"></path><path d="M18 14h-8"></path><path d="M15 18h-5"></path><path d="M10 6h8v4h-8z"></path></svg>' 
          },
          { 
              name: "Community", 
              path: "/community/", 
              icon: '<svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>' 
          },
          { 
              name: "About", 
              path: "/about/", 
              icon: '<svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>' 
          },
        ];

        // State
        let dropdownOpen = false;
        let lastScrollTop = 0;
        let scrollTimeout = null;

        // Get current path
        const getCurrentPath = () => {
            const path = window.location.pathname;
            return path.endsWith('/') ? path : path + '/';
        };

        // Check if path is active
        const isActive = (itemPath) => {
            const currentPath = getCurrentPath();
            const normalizedItemPath = itemPath.endsWith('/') ? itemPath : itemPath + '/';
            
            if (normalizedItemPath === '/') {
                return currentPath === '/';
            }
            
            return currentPath.startsWith(normalizedItemPath) || currentPath === normalizedItemPath;
        };

        // Get active item
        const getActiveItem = () => {
            return menuItems.find(item => isActive(item.path)) || menuItems[0];
        };

        // Check if mobile
        const isMobile = () => window.innerWidth < 1024;

        // Update mobile active item display
        const updateMobileDisplay = () => {
            const activeItem = getActiveItem();
            const iconEl = document.getElementById('active-icon');
            const nameEl = document.getElementById('active-name');
            if (iconEl && nameEl) {
                iconEl.innerHTML = activeItem.icon;
                nameEl.textContent = activeItem.name;
            }
        };

        // Render desktop menu
        const renderDesktopMenu = () => {
            const desktopMenu = document.getElementById('desktop-menu');
            if (desktopMenu) {
                desktopMenu.innerHTML = menuItems.map(item => `
                    <li>
                        <a href="${item.path}" 
                           class="hover:opacity-100 opacity-45 transition-opacity flex items-center space-x-2 ${isActive(item.path) ? 'opacity-100' : ''}">
                            ${item.icon}
                            <span>${item.name}</span>
                        </a>
                    </li>
                `).join('');
            }
        };

        // Render mobile menu
        const renderMobileMenu = () => {
            const mobileMenu = document.getElementById('mobile-menu');
            if (mobileMenu) {
                mobileMenu.innerHTML = menuItems.map(item => `
                    <li>
                        <a href="${item.path}" 
                           class="flex items-center space-x-2 text-sm hover:opacity-100 opacity-75 transition-opacity ${isActive(item.path) ? 'opacity-100' : ''}">
                            ${item.icon}
                            <span>${item.name}</span>
                        </a>
                    </li>
                `).join('');
            }
        };

        // Toggle dropdown
        const toggleDropdown = () => {
            dropdownOpen = !dropdownOpen;
            const dropdown = document.getElementById('dropdown-menu');
            if (dropdown) {
                dropdown.classList.toggle('scale-0');
                dropdown.classList.toggle('scale-100');
            }
        };

        // Close dropdown
        const closeDropdown = () => {
            if (dropdownOpen) {
                dropdownOpen = false;
                const dropdown = document.getElementById('dropdown-menu');
                if (dropdown) {
                    dropdown.classList.add('scale-0');
                    dropdown.classList.remove('scale-100');
                }
            }
        };

        // Handle scroll
        const handleScroll = () => {
            const currentScrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const navbar = document.getElementById('navbar-container');

            if (navbar) {
                if (currentScrollTop > lastScrollTop && currentScrollTop > 200) {
                    navbar.classList.add('-translate-y-[500px]');
                    navbar.classList.remove('translate-y-0');
                    if (isMobile()) {
                        closeDropdown();
                    }
                } else if (currentScrollTop + 20 < lastScrollTop) {
                    navbar.classList.remove('-translate-y-[500px]');
                    navbar.classList.add('translate-y-0');
                }
            }

            lastScrollTop = currentScrollTop <= 0 ? 0 : currentScrollTop;
        };

        const throttledHandleScroll = () => {
            if (scrollTimeout === null) {
                scrollTimeout = setTimeout(() => {
                    handleScroll();
                    scrollTimeout = null;
                }, 100);
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderDesktopMenu();
            renderMobileMenu();
            updateMobileDisplay();

            const dropdownButton = document.getElementById('dropdown-button');
            if (dropdownButton) {
                dropdownButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleDropdown();
                });
            }

            // Close dropdown on outside click
            document.addEventListener('click', (e) => {
                const dropdown = document.getElementById('dropdown-menu');
                const dropdownBtn = document.getElementById('dropdown-button');
                if (dropdownOpen && dropdown && dropdownBtn && 
                    !dropdown.contains(e.target) && !dropdownBtn.contains(e.target)) {
                    closeDropdown();
                }
            });

            // Close dropdown on menu item click
            document.querySelectorAll('#mobile-menu a').forEach(link => {
                link.addEventListener('click', closeDropdown);
            });

            // Close dropdown on resize
            window.addEventListener('resize', () => {
                if (!isMobile()) {
                    closeDropdown();
                }
                updateMobileDisplay();
            });

            // Scroll handler
            window.addEventListener('scroll', throttledHandleScroll);
        });
    </script>

    <!-- Script untuk Notifikasi Toast (dari file asli bagian pertama) -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const toasts = document.querySelectorAll('.toast-element');
            
            toasts.forEach((toast, index) => {
                // Animasikan toast masuk
                setTimeout(() => {
                    toast.classList.remove('opacity-0', '-translate-y-5');
                }, 300 * index); 
                
                // Animasikan toast keluar dan hapus
                setTimeout(() => {
                    toast.classList.add('opacity-0');
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 500); 
                }, 5000 + (300 * index)); 
            });
        });
    </script>
</body>
</html>
